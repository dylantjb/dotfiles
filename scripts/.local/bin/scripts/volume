#!/usr/bin/env bash

# You can call this script like this:
# $./volume up
# $./volume down
# $./volume mute

# Script modified from these wonderful people:
# https://github.com/dastorm/volume-notification-dunst/blob/master/volume.sh
# https://gist.github.com/sebastiencs/5d7227f388d93374cebdf72e783fbd6a
# https://gist.github.com/Blaradox/030f06d165a82583ae817ee954438f2e


get_icon() {
  level="$(get_volume)"
  is_mute && muted=1 || muted=0
  case 1 in
    $((level > 0 && level < 30 && muted==0)) ) echo \
      "/usr/share/icons/Papirus-Dark/48x48/status/notification-audio-volume-low.svg";;
    $((level >= 30 && level <= 70 && muted==0)) ) echo \
      "/usr/share/icons/Papirus-Dark/48x48/status/notification-audio-volume-medium.svg";;
    $((level >= 70 && level <= 100 && muted==0)) ) echo \
      "/usr/share/icons/Papirus-Dark/48x48/status/notification-audio-volume-high.svg";;
    *) echo "/usr/share/icons/Papirus-Dark/48x48/status/notification-audio-volume-muted.svg"
  esac
}

get_volume() { amixer get Master | grep '%' | head -n 1 | cut -d '[' -f 2 | cut -d '%' -f 1 ; }
is_mute() { amixer get Master | grep '%' | grep -oE '[^ ]+$' | grep off > /dev/null ; }

send_notification() {
  ! is_mute && volume="Volume [$(get_volume)%]" || volume="Volume: Muted"
  dunstify "$volume" -i "$(get_icon)" -r 2593 -u low -h int:value:"$(get_volume)"
}

case $1 in
  up)
    # increase the volume by 5%
    amixer set Master on > /dev/null
    amixer set Master 5%+ > /dev/null
    send_notification
    ;;
  down)
    # descrease the volume by 5%
    amixer set Master on > /dev/null
    amixer set Master 5%- > /dev/null
    send_notification
    ;;
  mute)
    # mute or unmute the volume
    amixer set Master 1+ toggle > /dev/null
    send_notification
    ;;
esac

